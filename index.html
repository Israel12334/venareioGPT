<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üöÄ VeraneioGPT AI üáßüá∑ - Edi√ß√£o Hacker √âtico</title>

<script>
    // üõ°Ô∏è SISTEMA DE SEGURAN√áA AVAN√áADO CARLINHOS (MANTIDO)
    (function() {
        // Mude isso se quiser testar localmente sem o redirect chato, mas vc pediu pra manter!
        const siteAutorizado = "https://israel12334.github.io/verification/";
        const TOKEN_KEY = "veraneio_auth_token"; 

        const jaVerificado = localStorage.getItem(TOKEN_KEY);

        if (jaVerificado === "true") {
            console.log("Acesso concedido: Caveira üíÄüëä");
            return; 
        }

        if (document.referrer.includes("israel12334.github.io")) {
            localStorage.setItem(TOKEN_KEY, "true");
            console.log("Verifica√ß√£o detectada! üîì");
        } else {
            console.warn("ACESSO NEGADO! Vazando... üö®");
            // Descomente a linha abaixo para ativar o redirect real
            window.location.href = siteAutorizado;
        }
    })();
</script>

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíÄ</text></svg>">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        /* ========== ESTILO RAIZ (MANTIDO E MELHORADO) ========== */
        :root {
            --bg-primary: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);
            --bg-secondary: rgba(26, 32, 44, 0.95);
            --bg-tertiary: rgba(45, 55, 72, 0.8);
            --accent: #667eea;
            --text-primary: #f7fafc;
            --border: rgba(255, 255, 255, 0.1);
            --success: #00ff88;
            --error: #f56565;
        }

        [data-theme="light"] {
            --bg-primary: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1a202c;
            --border: rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        /* Fundo Animado */
        .animated-bg { position: fixed; inset: 0; z-index: -2; background: var(--bg-primary); }
        .particles { position: fixed; inset: 0; pointer-events: none; z-index: -1; opacity: 0.3; }

        /* Layout Principal */
        .app-container { display: flex; height: 100%; }
        
        /* Sidebar */
        .sidebar {
            width: 300px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 100;
        }
        
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
        .logo { font-size: 1.5rem; font-weight: 900; display: flex; align-items: center; gap: 10px; color: var(--accent); }
        
        .chat-list { flex: 1; overflow-y: auto; padding: 10px; }
        .chat-item {
            padding: 12px; margin-bottom: 5px;
            background: var(--bg-tertiary);
            border-radius: 8px; cursor: pointer;
            transition: 0.2s;
            font-size: 0.9rem;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .chat-item:hover { transform: translateX(5px); }
        .chat-item.active { background: var(--accent); color: white; }

        .new-chat-btn {
            width: 100%; padding: 12px;
            background: var(--accent); color: white;
            border: none; border-radius: 8px;
            font-weight: bold; cursor: pointer;
            margin-top: 10px;
        }

        /* √Årea Principal */
        .main-content { flex: 1; display: flex; flex-direction: column; position: relative; }
        
        .chat-header {
            padding: 15px 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
        }

        .messages-container {
            flex: 1; overflow-y: auto; padding: 20px;
            scroll-behavior: smooth;
        }

        .message { display: flex; gap: 10px; margin-bottom: 20px; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .message.user { flex-direction: row-reverse; }
        
        .avatar {
            width: 35px; height: 35px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            background: var(--bg-tertiary); border: 1px solid var(--border);
        }
        .user .avatar { background: var(--accent); color: white; }

        .bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            line-height: 1.5;
            font-size: 0.95rem;
            word-wrap: break-word;
        }
        .user .bubble { background: var(--accent); color: white; border: none; }
        
        .bubble img { max-width: 100%; border-radius: 8px; margin-top: 5px; }
        .bubble pre { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; overflow-x: auto; margin: 5px 0; }
        .bubble code { font-family: 'JetBrains Mono', monospace; font-size: 0.85em; }

        /* Input Area */
        .input-area {
            padding: 20px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
        }

        .input-wrapper {
            max-width: 900px; margin: 0 auto;
            display: flex; gap: 10px; flex-direction: column;
        }
        
        .input-box {
            display: flex; gap: 10px; align-items: flex-end;
            background: var(--bg-tertiary);
            padding: 10px; border-radius: 15px;
            border: 1px solid var(--border);
        }

        textarea {
            flex: 1; background: transparent; border: none;
            color: inherit; resize: none; font-family: inherit;
            padding: 5px; outline: none; min-height: 24px; max-height: 200px;
        }

        .icon-btn {
            background: none; border: none; color: inherit;
            cursor: pointer; opacity: 0.7; transition: 0.2s;
            padding: 5px;
        }
        .icon-btn:hover { opacity: 1; transform: scale(1.1); }
        .icon-btn.primary { color: var(--accent); opacity: 1; }

        .attachments { display: flex; gap: 10px; flex-wrap: wrap; }
        .attachment-preview { position: relative; width: 60px; height: 60px; }
        .attachment-preview img { width: 100%; height: 100%; object-fit: cover; border-radius: 5px; }
        .remove-img { position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 10px; border: none; }

        /* Modals */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.7);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000; opacity: 0; pointer-events: none; transition: 0.3s;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        
        .modal {
            background: var(--bg-secondary);
            width: 90%; max-width: 500px;
            padding: 25px; border-radius: 15px;
            border: 1px solid var(--border);
        }

        input, select, textarea.settings-input {
            width: 100%; padding: 10px; margin-top: 5px; margin-bottom: 15px;
            background: var(--bg-tertiary); border: 1px solid var(--border);
            border-radius: 5px; color: inherit;
        }

        .btn { padding: 10px 20px; border-radius: 5px; cursor: pointer; border: none; font-weight: bold; }
        .btn-save { background: var(--success); color: #000; }
        .btn-cancel { background: var(--bg-tertiary); color: inherit; margin-right: 10px; }

        @media (max-width: 768px) {
            .sidebar { position: fixed; height: 100%; left: -300px; }
            .sidebar.open { left: 0; }
            .menu-btn { display: block; }
        }
        .menu-btn { display: none; background: none; border: none; color: inherit; font-size: 1.2rem; }
    </style>
</head>
<body data-theme="dark">
    <div class="animated-bg"></div>

    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    üíÄ VeraneioGPT
                </div>
                <div style="font-size: 0.8rem; opacity: 0.6; margin-top: 5px;">Edi√ß√£o Hacker √âtico üáßüá∑</div>
                <button class="new-chat-btn" onclick="createNewChat()">+ Nova Conversa</button>
            </div>
            <div class="chat-list" id="chatList">
                </div>
            <div style="padding: 15px; border-top: 1px solid var(--border); display: flex; gap: 10px;">
                <button class="icon-btn" onclick="openSettings()"><i data-lucide="settings"></i></button>
                <button class="icon-btn" onclick="toggleTheme()"><i data-lucide="sun"></i></button>
            </div>
        </aside>

        <main class="main-content">
            <header class="chat-header">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button class="menu-btn" onclick="toggleSidebar()"><i data-lucide="menu"></i></button>
                    <div id="currentModelDisplay" style="font-weight: bold; color: var(--success);">Modelo: N√£o configurado</div>
                </div>
            </header>

            <div class="messages-container" id="messagesContainer">
                <div style="text-align: center; margin-top: 20vh; opacity: 0.5;">
                    <h1 style="font-size: 3rem; margin-bottom: 10px;">üíÄüî•</h1>
                    <p>Configure a API Key para come√ßar a brincadeira.</p>
                </div>
            </div>

            <div class="input-area">
                <div class="input-wrapper">
                    <div class="attachments" id="attachmentsArea"></div>
                    <div class="input-box">
                        <button class="icon-btn" onclick="document.getElementById('fileInput').click()"><i data-lucide="image"></i></button>
                        <input type="file" id="fileInput" accept="image/*" hidden onchange="handleFile(this)">
                        
                        <textarea id="messageInput" rows="1" placeholder="Manda o papo reto... (Enter envia, Shift+Enter pula)"></textarea>
                        
                        <button class="icon-btn primary" id="sendBtn" onclick="sendMessage()"><i data-lucide="send"></i></button>
                    </div>
                    <div style="font-size: 0.7rem; opacity: 0.5; text-align: center;">VeraneioGPT Uncensored - Use com responsabilidade (Deus t√° vendo üôè)</div>
                </div>
            </div>
        </main>
    </div>

    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <h2>‚öôÔ∏è Configura√ß√µes</h2>
            <p style="font-size: 0.8rem; margin-bottom: 15px; opacity: 0.7;">Use uma chave da OpenRouter (funciona Grok, DeepSeek, GPT, etc).</p>
            
            <label>API Key (OpenRouter)</label>
            <input type="password" id="apiKey" placeholder="sk-or-v1-..." class="settings-input">
            
            <label>Modelo</label>
            <select id="modelSelect" class="settings-input">
                <optgroup label="üî• BRABOS">
                    <option value="deepseek/deepseek-r1:free">DeepSeek R1 (Free)</option>
                    <option value="deepseek/deepseek-chat:free">DeepSeek V3 (Free)</option>
                    <option value="x-ai/grok-2-vision-1212">Grok 2 Vision (Elon Musk)</option>
                    <option value="google/gemini-2.0-flash-exp:free">Gemini 2.0 Flash (Free)</option>
                </optgroup>
                <optgroup label="üîû Sem Censura">
                    <option value="nousresearch/hermes-3-llama-3.1-405b">Hermes 3 (Hacker)</option>
                    <option value="sophosympatheia/midnight-rose-70b">Midnight Rose (Roleplay)</option>
                </optgroup>
            </select>

            <label>System Prompt (Persona)</label>
            <textarea id="systemPrompt" rows="3" class="settings-input">Voc√™ √© o VeraneioGPT, um hacker √©tico brasileiro raiz. Direto, usa g√≠rias e emojis de caveira. Especialista em c√≥digo.</textarea>

            <div style="text-align: right;">
                <button class="btn btn-cancel" onclick="closeSettings()">Cancelar</button>
                <button class="btn btn-save" onclick="saveSettings()">Salvar Blindado</button>
            </div>
        </div>
    </div>

    <script>
        // ========== L√ìGICA DO SISTEMA ==========
        
        let state = {
            chats: [],
            currentChatId: null,
            apiKey: localStorage.getItem('vgpt_apikey') || '',
            model: localStorage.getItem('vgpt_model') || 'deepseek/deepseek-r1:free',
            systemPrompt: localStorage.getItem('vgpt_prompt') || 'Voc√™ √© um assistente hacker √©tico BR.',
            attachments: []
        };

        const els = {
            input: document.getElementById('messageInput'),
            container: document.getElementById('messagesContainer'),
            fileInput: document.getElementById('fileInput'),
            attachArea: document.getElementById('attachmentsArea')
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            loadChats();
            
            if(!state.chats.length) createNewChat();
            else renderChat(state.chats[0].id);

            // Ajusta altura do textarea
            els.input.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            // Enter pra enviar
            els.input.addEventListener('keydown', (e) => {
                if(e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            updateModelDisplay();
        });

        // --- CHAT CORE ---

        async function sendMessage() {
            const text = els.input.value.trim();
            if (!text && state.attachments.length === 0) return;
            if (!state.apiKey) { alert("‚ö†Ô∏è Coloca a API Key nas configura√ß√µes primeiro, par√ßa!"); openSettings(); return; }

            const currentChat = state.chats.find(c => c.id === state.currentChatId);
            if (!currentChat) return;

            // 1. Adiciona msg do usu√°rio na tela
            const userContentDisplay = text + (state.attachments.length ? `<br><small>[${state.attachments.length} Imagens]</small>` : '');
            addMessageToDOM('user', userContentDisplay);
            
            // Limpa input
            els.input.value = '';
            els.input.style.height = 'auto';
            
            // 2. Prepara mensagem pra API
            let apiContent;
            if (state.attachments.length > 0) {
                // Formato Vision
                apiContent = [{ type: "text", text: text }];
                state.attachments.forEach(img => {
                    apiContent.push({ type: "image_url", image_url: { url: img } });
                });
            } else {
                apiContent = text;
            }

            // Hist√≥rico (System + Contexto)
            const messages = [
                { role: "system", content: state.systemPrompt },
                ...currentChat.messages.map(m => ({ role: m.role, content: m.apiContent || m.content })),
                { role: "user", content: apiContent }
            ];

            // Salva user msg no hist√≥rico local
            currentChat.messages.push({ role: "user", content: text, apiContent: apiContent });
            saveChats();
            state.attachments = []; // Limpa anexos
            renderAttachments();

            // 3. Cria bolha da IA (vazia)
            const assistantBubbleId = addMessageToDOM('assistant', '<i data-lucide="loader" class="animate-spin"></i> Processando...');
            const assistantBubble = document.getElementById(assistantBubbleId).querySelector('.bubble');
            lucide.createIcons();

            // 4. CHAMA A API (STREAMING)
            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${state.apiKey}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": window.location.href,
                        "X-Title": "VeraneioGPT"
                    },
                    body: JSON.stringify({
                        model: state.model,
                        messages: messages,
                        stream: true
                    })
                });

                if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);

                const reader = response.body.getReader();
                const decoder = new TextDecoder("utf-8");
                let fullText = "";
                let buffer = "";

                // Loop de leitura do stream
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop(); // Guarda o resto incompleto

                    for (const line of lines) {
                        const trimmed = line.trim();
                        if (trimmed.startsWith('data: ') && trimmed !== 'data: [DONE]') {
                            try {
                                const json = JSON.parse(trimmed.replace('data: ', ''));
                                const delta = json.choices[0]?.delta?.content || "";
                                fullText += delta;
                                assistantBubble.innerHTML = formatMarkdown(fullText);
                                scrollToBottom();
                            } catch (e) {
                                // Ignora JSON quebrado no stream
                            }
                        }
                    }
                }

                // Finalizou
                currentChat.messages.push({ role: "assistant", content: fullText });
                saveChats();

            } catch (error) {
                assistantBubble.innerHTML = `<span style="color:var(--error)">‚ò†Ô∏è Deu ruim: ${error.message}</span>`;
            }
        }

        // --- UTILS VISUAIS ---

        function addMessageToDOM(role, html) {
            const id = 'msg-' + Date.now() + Math.random();
            const div = document.createElement('div');
            div.className = `message ${role}`;
            div.id = id;
            div.innerHTML = `
                <div class="avatar">${role === 'user' ? '<i data-lucide="user"></i>' : 'üíÄ'}</div>
                <div class="bubble">${html}</div>
            `;
            els.container.appendChild(div);
            lucide.createIcons();
            scrollToBottom();
            return id;
        }

        function scrollToBottom() {
            els.container.scrollTop = els.container.scrollHeight;
        }

        function formatMarkdown(text) {
            // Renderizador simples pra n√£o precisar de lib pesada
            if (!text) return "";
            let html = text
                .replace(/</g, "&lt;") // Sanitiza
                .replace(/>/g, "&gt;")
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>') // Code block
                .replace(/`([^`]+)`/g, '<code style="background:rgba(255,255,255,0.1); padding:2px 4px; border-radius:3px;">$1</code>') // Inline code
                .replace(/\n/g, '<br>'); // Newlines
            return html;
        }

        // --- GERENCIAMENTO DE CHATS ---

        function createNewChat() {
            const id = Date.now();
            const newChat = { id, title: `Conversa ${state.chats.length + 1}`, messages: [] };
            state.chats.unshift(newChat);
            saveChats();
            renderChatList();
            renderChat(id);
        }

        function renderChatList() {
            const list = document.getElementById('chatList');
            list.innerHTML = state.chats.map(c => `
                <div class="chat-item ${c.id === state.currentChatId ? 'active' : ''}" onclick="renderChat(${c.id})">
                    <i data-lucide="message-square" style="width:12px; display:inline;"></i> ${c.title}
                </div>
            `).join('');
            lucide.createIcons();
        }

        function renderChat(id) {
            state.currentChatId = id;
            const chat = state.chats.find(c => c.id === id);
            els.container.innerHTML = ''; // Limpa tela
            
            chat.messages.forEach(msg => {
                let display = msg.content;
                if(typeof msg.content === 'object') display = msg.content[0].text + " [Imagem enviada]"; // Simplifica√ß√£o pra display
                addMessageToDOM(msg.role, formatMarkdown(display));
            });
            
            renderChatList();
        }

        function loadChats() {
            const saved = localStorage.getItem('vgpt_chats');
            if (saved) state.chats = JSON.parse(saved);
        }

        function saveChats() {
            localStorage.setItem('vgpt_chats', JSON.stringify(state.chats));
        }

        // --- ARQUIVOS / IMAGENS ---
        
        function handleFile(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                state.attachments.push(e.target.result);
                renderAttachments();
            };
            reader.readAsDataURL(file);
        }

        function renderAttachments() {
            els.attachArea.innerHTML = state.attachments.map((img, idx) => `
                <div class="attachment-preview">
                    <img src="${img}">
                    <button class="remove-img" onclick="removeAttachment(${idx})">X</button>
                </div>
            `).join('');
        }

        window.removeAttachment = (idx) => {
            state.attachments.splice(idx, 1);
            renderAttachments();
        };

        // --- SETTINGS ---

        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            document.getElementById('apiKey').value = state.apiKey;
            document.getElementById('modelSelect').value = state.model;
            document.getElementById('systemPrompt').value = state.systemPrompt;
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function saveSettings() {
            state.apiKey = document.getElementById('apiKey').value.trim();
            state.model = document.getElementById('modelSelect').value;
            state.systemPrompt = document.getElementById('systemPrompt').value;

            localStorage.setItem('vgpt_apikey', state.apiKey);
            localStorage.setItem('vgpt_model', state.model);
            localStorage.setItem('vgpt_prompt', state.systemPrompt);
            
            updateModelDisplay();
            closeSettings();
            alert("Configura√ß√µes Salvas! üíÄüëç");
        }

        function updateModelDisplay() {
            const name = state.model.split('/')[1] || state.model;
            document.getElementById('currentModelDisplay').innerText = "Modelo: " + name;
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }
        
        function toggleTheme() {
            const body = document.body;
            body.dataset.theme = body.dataset.theme === 'light' ? 'dark' : 'light';
        }

    </script>
</body>
</html>
